// Copyright 2017-2022 @polkadot/vue-identicon authors & contributors
// SPDX-License-Identifier: Apache-2.0
import Vue from 'vue';
import { isHex, isU8a, u8aToHex } from '@polkadot/util';
import { decodeAddress, encodeAddress } from '@polkadot/util-crypto';
import { Beachball, Empty, Jdenticon, Polkadot } from "./icons/index.js";
const DEFAULT_SIZE = 64;

function encodeAccount(value, prefix) {
  try {
    const address = isU8a(value) || isHex(value) ? encodeAddress(value, prefix) : value;
    const publicKey = u8aToHex(decodeAddress(address, false, prefix));
    return {
      address,
      publicKey
    };
  } catch (error) {
    return {
      address: '',
      publicKey: '0x'
    };
  }
}
/**
 * @name Identicon
 * @description The main Identicon component, taking a number of properties
 * @example
 * ```html
 * <Identicon :size="128" :theme="polkadot" :value="..." />
 * ```
 */


export const Identicon = Vue.extend({
  components: {
    Beachball,
    Empty,
    Jdenticon,
    Polkadot
  },
  created: function () {
    this.createData();
  },
  data: function () {
    return {
      address: '',
      iconSize: DEFAULT_SIZE,
      isAlternativeIcon: false,
      publicKey: '0x',
      type: 'empty'
    };
  },
  methods: {
    createData: function () {
      this.iconSize = this.size || DEFAULT_SIZE;
      this.type = this.theme;
      this.isAlternativeIcon = this.isAlternative || false;
      this.recodeAddress();
    },
    recodeAddress: function () {
      const {
        address,
        publicKey
      } = encodeAccount(this.value);
      this.address = address;
      this.publicKey = publicKey;
    }
  },
  props: ['prefix', 'isAlternative', 'size', 'theme', 'value'],

  render(h) {
    const {
      address,
      iconSize,
      isAlternativeIcon,
      publicKey,
      type
    } = this.$data;

    if (type === 'empty') {
      return h('Empty', {
        attrs: {
          key: address,
          size: iconSize
        }
      }, []);
    } else if (type === 'jdenticon') {
      return h('Jdenticon', {
        attrs: {
          key: address,
          publicKey,
          size: iconSize
        }
      }, []);
    } else {
      // handles: beachball and polkadot
      // TODO: substrate
      const cmp = type.charAt(0).toUpperCase() + type.slice(1);
      return h(cmp, {
        attrs: {
          address,
          isAlternative: isAlternativeIcon,
          key: address,
          size: iconSize
        }
      }, []);
    }
  },

  watch: {
    value: function () {
      this.recodeAddress();
    }
  }
});